sap.ui.define(["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";var t="nida.afreen@peolsolutions.com";var t;return e.extend("department.departmentapp.ext.controller.Objectcontroller",{override:{onInit:function(){debugger;var e=this.base.getExtensionAPI().getModel()},routing:{onBeforeBinding:async function(e){debugger;var t=this.getView().getModel("ui");var n=t.oData.editMode;var r=this.base.getView().byId("lec::TeacherObjectPage--fe::CustomSubSection::Att--uploadSet");var a=r.getBindingInfo("items");var i=a.template;if(n=="Editable"){r.setUploadButtonInvisible(false);i.setVisibleRemove(true);i.setVisibleEdit(true);r.setUploadEnabled(true)}else{r.setUploadButtonInvisible(true);i.setVisibleRemove(false);i.setVisibleEdit(false);r.setUploadEnabled(false)}debugger;var o=this.base.getExtensionAPI().getModel();if(!o){console.error("Model is not available.");return}const s=this.base.getView();const l=s.mAggregations.content[0];debugger;const u=l.findAggregatedObjects(true,function(e){return e.isA("sap.m.Button")&&(e.getId().includes("Save")||e.getId().includes("Edit")||e.getId().includes("Delete"))});const c=u[0];const d=u[1];const g=u[2];setTimeout(function(){debugger;if(g.getText().includes("Create")){g.setText("Send for Approval")}}.bind(this),1e3);var f;if(typeof o.getServiceUrl==="function"){f=o.getServiceUrl();console.log("Service URL:",f)}else{console.error("Unable to determine the service URL.");return}debugger;this.adjustUIControls();await this.fetchAndProcessData(f)}}},adjustUIControls:function(){var e=this;setTimeout(function(){e.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.Button")||e.isA("sap.m.DatePicker")||e.isA("sap.m.Input")||e.isA("sap.m.TextArea")||e.isA("sap.m.ComboBox")}).forEach(function(t){var n=t.getId();if(t.isA("sap.m.Button")&&n.includes("Save")&&t.getVisible()===true){debugger;var r=this.base.getView();var a=r.findAggregatedObjects(true);var i=a.filter(function(e){return e.getId().includes("uploadSet-uploader")});i.forEach(function(e){e.setVisible(true)});var o=a.filter(function(e){return e.getId().includes("uploadSet")});o.forEach(function(e){console.log("Control ID:",e.getId());console.log("Control Type:",e.getMetadata().getName());if(e.isA("sap.m.Button")&&e.getId().includes("deleteButton")){e.setVisible(true);e.setEnabled(true)}})}if(t.isA("sap.m.Button")&&n.includes("Save")&&t.getVisible()===false){debugger;var r=this.base.getView();var a=r.findAggregatedObjects(true);var i=a.filter(function(e){return e.getId().includes("uploadSet-uploader")});i.forEach(function(e){e.setVisible(false)});var o=a.filter(function(e){return e.getId().includes("uploadSet")});o.forEach(function(e){console.log("Control ID:",e.getId());console.log("Control Type:",e.getMetadata().getName());if(e.isA("sap.m.Button")&&e.getId().includes("deleteButton")){e.setVisible(false);e.setEnabled(false)}})}if(t.isA("sap.m.Input")&&n.includes("Age")){var s=e.base.getView().byId("nwteacher::TeacherObjectPage--fe::FormContainer::GeneratedFacet1::FormElement::DataField::DOB::Field-edit");if(s){var l=s.getDateValue();if(l){var u=e.calculateAge(l);t.setValue(u)}}}}.bind(e))}.bind(e),500)},calculateAge:function(e){var t=new Date;var n=new Date(e);if(n>t){alert("Birthdate is in the future. Age cannot be calculated.");console.log("Birthdate is in the future. Age cannot be calculated.");return null}var r=t.getFullYear()-n.getFullYear();var a=t.getMonth()-n.getMonth();if(a<0||a===0&&t.getDate()<n.getDate()){r--}if(r>=18){return r}else{alert("You must be at least 18 years old.");return null}},setAgeField:function(e){var t=this;setTimeout(function(){t.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.Input")&&e.getId().includes("Age")}).forEach(function(t){t.setValue(e);console.log("Age field set to:",e)})}.bind(t),500)},fetchAndProcessData:async function(e){var n=this;try{const n=await new Promise((t,n)=>{jQuery.ajax({url:e+"/authorisation",method:"GET",dataType:"json",success:function(e){t(e)},error:function(e,t,r){n(new Error(t+": "+r))}})});const u=await new Promise((t,n)=>{jQuery.ajax({url:e+"/Department",method:"GET",dataType:"json",success:function(e){t(e)},error:function(e,t,r){n(new Error(t+": "+r))}})});debugger;console.log("Fetched auth data:",n);console.log("Fetched dept data:",u);if(n&&n.value&&Array.isArray(n.value)&&u&&u.value&&Array.isArray(u.value)){var r=n.value.find(e=>e.Email===t);if(!r){debugger;console.error("User not found in authorisation data.");return}var a=r.role;console.log(`User Role: ${a}`);var i=this.getView().getBindingContext();var o=i.getPath();var s=null;var l=o.match(/DepartmentID='([^']+)'/);if(l&&l[1]){s=l[1]}if(a!==s&&a!=="Admin"){this.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.Button")}).forEach(function(e){if(e.getId().includes("Edit")||e.getId().includes("Delete")||e.getId().includes("Create")){e.setVisible(false)}})}if(a!=="Admin"){debugger;this.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.Input")&&e.getBindingPath("value")==="DepartmentName"}).forEach(function(e){e.setEditable(false)})}}}catch(e){console.error("Error fetching data",e)}try{var u=window.location.href;var c=u.split("#")[1];console.log(c);var d=c.match(/ttuuid=([^,]+)/)[1];console.log(d);const t=await new Promise((t,n)=>{jQuery.ajax({url:`${e}/Teacher(ttuuid=${d},IsActiveEntity=true)`,method:"GET",dataType:"json",success:function(e){t(e)},error:function(e,t,r){console.error("Error fetching role data",e,t,r);n(new Error(t+": "+r))}})});console.log(t);var a;if(t&&t.Status){console.log(t.Status);if(t.Status==="Approved"){a=t.Status;console.log("userRole: ",a)}}else{console.log("No data found or invalid response format")}this.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.Button")}).forEach(function(e){if(e.getId().includes("Edit")||e.getId().includes("Delete")){if(a==="Approved"){e.setVisible(true);e.setEnabled(true)}else{e.setVisible(false);e.setEnabled(false)}}})}catch(e){console.error("Error fetching role data",e)}}})});
//# sourceMappingURL=Objectcontroller.controller.js.map