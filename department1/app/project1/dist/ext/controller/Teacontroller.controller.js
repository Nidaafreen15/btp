sap.ui.define(["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";return e.extend("project1.ext.controller.Teacontroller",{override:{onInit:function(){debugger;var e=this.base.getExtensionAPI().getModel()},routing:{onBeforeBinding:async function(e){debugger;var t=(new sap.ushell.services.UserInfo).getEmail();var t="nida.afreen@peolsolutions.com";var n=this.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.DatePicker")&&e.getId().includes("dob")});var a=new Date;var r=new Date(a.getFullYear()-25,a.getMonth(),a.getDate());n[0].setMaxDate(r)},adjustUIControls:function(){var e=this;setTimeout(function(){e.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.Button")||e.isA("sap.m.DatePicker")||e.isA("sap.m.Input")||e.isA("sap.m.TextArea")||e.isA("sap.m.ComboBox")}).forEach(function(e){var t=e.getId();if(e.isA("sap.m.Button")&&t.includes("Save")){e.setText("Send for approval")}}.bind(e))}.bind(e),500)},fetchAndProcessData:async function(e){var t=this;try{const t=await new Promise((t,n)=>{jQuery.ajax({url:e+"/authorisation",method:"GET",dataType:"json",success:function(e){t(e)},error:function(e,t,a){n(new Error(t+": "+a))}})});const g=await new Promise((t,n)=>{jQuery.ajax({url:e+"/Department",method:"GET",dataType:"json",success:function(e){t(e)},error:function(e,t,a){n(new Error(t+": "+a))}})});debugger;console.log("Fetched auth data:",t);console.log("Fetched dept data:",g);if(t&&t.value&&Array.isArray(t.value)&&g&&g.value&&Array.isArray(g.value)){var n=t.value.find(e=>e.Email===useremail);if(!n){debugger;console.error("User not found in authorisation data.");return}var a=n.role;console.log(`User Role: ${a}`);var r=this.getView().getBindingContext();var i=r.getPath();var o=null;var s=i.match(/DepartmentID='([^']+)'/);if(s&&s[1]){o=s[1]}if(a!==o&&a!=="Admin"){this.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.Button")}).forEach(function(e){if(e.getId().includes("Edit")||e.getId().includes("Delete")||e.getId().includes("Create")){e.setVisible(false)}})}if(a!=="Admin"){debugger;this.base.getView().findAggregatedObjects(true,function(e){return e.isA("sap.m.Input")&&e.getBindingPath("value")==="DepartmentName"}).forEach(function(e){e.setEditable(false)})}}}catch(e){console.error("Error fetching data",e)}},onAfterBinding:async function(e){debugger;var t;var n=null;var a=this.base.getView().getContent()[0].getSections()[1].mAggregations._grid.mAggregations.content[0].mAggregations._grid.mAggregations.content[0].mAggregations.content.sId;await this.base.getView().getContent()[0].getSections()[1].mAggregations._grid.mAggregations.content[0].mAggregations._grid.mAggregations.content[0].mAggregations.content.setUploadEnabled(false);var r=null;try{r=await this.getView().getContent()[0].mAggregations.footer.sId}catch(e){r=null}debugger;setTimeout(async()=>{sap.ui.getCore().byId(r).mAggregations.content.mAggregations.content.forEach(async e=>{if(e.getVisible()){if(e.getText()=="Discard Draft"){await sap.ui.getCore().byId(a).setUploadEnabled(true);await sap.ui.getCore().byId(a).mAggregations.items.forEach(async e=>{e.setEnabledRemove(true);e.setEnabledEdit(true)})}}})},400)}},_delay:function(e){return new Promise(t=>setTimeout(t,e))}}})});
//# sourceMappingURL=Teacontroller.controller.js.map